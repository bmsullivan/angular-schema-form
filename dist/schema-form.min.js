var deps=[];try{angular.module("ngSanitize"),deps.push("ngSanitize")}catch(e){}try{angular.module("ui.sortable"),deps.push("ui.sortable")}catch(e){}try{angular.module("angularSpectrumColorpicker"),deps.push("angularSpectrumColorpicker")}catch(e){}angular.module("schemaForm",deps),angular.module("schemaForm").provider("sfPath",[function(){var e={parse:ObjectPath.parse};e.stringify=1===angular.version.major&&angular.version.minor<3?function(e){return Array.isArray(e)?e.join("."):e.toString()}:ObjectPath.stringify,e.normalize=function(r,t){return e.stringify(Array.isArray(r)?r:e.parse(r),t)},this.parse=e.parse,this.stringify=e.stringify,this.normalize=e.normalize,this.$get=function(){return e}}]),angular.module("schemaForm").factory("sfSelect",["sfPath",function(e){var r=/^\d+$/;return function(t,n,a){n||(n=this);var i="string"==typeof t?e.parse(t):t;if("undefined"!=typeof a&&1===i.length)return n[i[0]]=a,n;"undefined"!=typeof a&&"undefined"==typeof n[i[0]]&&(n[i[0]]=i.length>2&&r.test(i[1])?[]:{});for(var o=n[i[0]],l=1;l<i.length;l++){if(""===i[l])return void 0;if("undefined"!=typeof a){if(l===i.length-1)return o[i[l]]=a,a;var u=o[i[l]];("undefined"==typeof u||null===u)&&(u=r.test(i[l+1])?[]:{},o[i[l]]=u),o=u}else o&&(o=o[i[l]])}return o}}]),angular.module("schemaForm").provider("schemaFormDecorators",["$compileProvider","sfPathProvider",function(e,r){var t="",n={},a=function(e,r){"sfDecorator"===e&&(e=t);for(var a=n[e],i=a.rules,o=0;o<i.length;o++){var l=i[o](r);if(l)return l}return a.mappings[r.type]?a.mappings[r.type]:a.mappings["default"]},i=function(t){e.directive(t,["$parse","$compile","$http","$templateCache",function(e,n,i,o){return{restrict:"AE",replace:!1,transclude:!1,scope:!0,require:"?^sfSchema",link:function(e,l,u,s){var c=e.$watch(u.form,function(u){if(u){e.form=u;var s=a(t,u);i.get(s,{cache:o}).then(function(t){var a=u.key?r.stringify(u.key).replace(/"/g,"&quot;"):"",i=t.data.replace(/\$\$value\$\$/g,"model"+("["!==a[0]?".":"")+a);l.html(i),n(l.contents())(e)}),c()}});e.remove=function(){e.$emit("sf-remove-element",{element:e.form})},e.showTitle=function(){return e.form&&e.form.notitle!==!0&&e.form.title},e.listToCheckboxValues=function(e){var r={};return angular.forEach(e,function(e){r[e]=!0}),r},e.checkboxValuesToList=function(e){var r=[];return angular.forEach(e,function(e,t){e&&r.push(t)}),r},e.buttonClick=function(r,t){angular.isFunction(t.onClick)?t.onClick(r,t):angular.isString(t.onClick)&&(s?s.evalInParentScope(t.onClick,{$event:r,form:t}):e.$eval(t.onClick,{$event:r,form:t}))},e.evalExpr=function(r,t){return s?s.evalInParentScope(r,t):e.$eval(r,t)},e.evalInScope=function(r,t){return r?e.$eval(r,t):void 0},e.errorMessage=function(r){return e.form.validationMessage?r?angular.isString(e.form.validationMessage)?e.form.validationMessage:e.form.validationMessage[r.code]||e.form.validationMessage["default"]:e.form.validationMessage.number||e.form.validationMessage["default"]||e.form.validationMessage:r?r.message:"Not a number"}}}}])},o=function(r,t,n){n=angular.isDefined(n)?n:!1,e.directive("sf"+angular.uppercase(r[0])+r.substr(1),function(){return{restrict:"EAC",scope:!0,replace:!0,transclude:n,template:'<sf-decorator form="form"></sf-decorator>',link:function(e,t,n){var a={items:"c",titleMap:"c",schema:"c"},i={type:r},o=!0;angular.forEach(n,function(r,t){if("$"!==t[0]&&0!==t.indexOf("ng")&&"sfField"!==t){var l=function(r){angular.isDefined(r)&&r!==i[t]&&(i[t]=r,o&&i.type&&(i.key||angular.isUndefined(n.key))&&(e.form=i,o=!1))};"model"===t?e.$watch(r,function(r){r&&e.model!==r&&(e.model=r)}):"c"===a[t]?e.$watchCollection(r,l):n.$observe(t,l)}})}}})};this.createDecorator=function(e,r,a){n[e]={mappings:r||{},rules:a||[]},n[t]||(t=e),i(e)},this.createDirective=o,this.createDirectives=function(e){angular.forEach(e,function(e,r){o(r,e)})},this.directive=function(e){return e=e||t,n[e]},this.addMapping=function(e,r,t){n[e]&&(n[e].mappings[r]=t)},this.$get=function(){return{directive:function(e){return n[e]},defaultDecorator:t}},i("sfDecorator")}]),angular.module("schemaForm").provider("schemaForm",["sfPathProvider",function(e){var r=function(e){var r=[];return e.forEach(function(e){r.push({name:e,value:e})}),r},t=function(e,r){if(!angular.isArray(e)){var t=[];return r?angular.forEach(r,function(r){t.push({name:e[r],value:r})}):angular.forEach(e,function(e,r){t.push({name:e,value:r})}),t}return e},n=function(e,r,t){var n=d[r.type];if(n)for(var a,i=0;i<n.length;i++)if(a=n[i](e,r,t))return a.schema["x-schema-form"]&&angular.isObject(a.schema["x-schema-form"])&&(a=angular.extend(a,a.schema["x-schema-form"])),a},a=function(e,r,n){n=n||{};var a=n.global&&n.global.formDefaults?angular.copy(n.global.formDefaults):{};return a.title=n.global&&n.global.supressPropertyTitles===!0?r.title:r.title||e,r.description&&(a.description=r.description),(n.required===!0||r.required===!0)&&(a.required=!0),r.maxLength&&(a.maxlength=r.maxLength),r.minLength&&(a.minlength=r.maxLength),(r.readOnly||r.readonly)&&(a.readonly=!0),r.minimum&&(a.minimum=r.minimum+(r.exclusiveMinimum?1:0)),r.maximum&&(a.maximum=r.maximum-(r.exclusiveMaximum?1:0)),r.validationMessage&&(a.validationMessage=r.validationMessage),r.enumNames&&(a.titleMap=t(r.enumNames,r["enum"])),a.schema=r,a.ngModelOptions=a.ngModelOptions||{},a},i=function(r,t,n){if("string"===t.type&&!t["enum"]){var i=a(r,t,n);return i.key=n.path,i.type="text",n.lookup[e.stringify(n.path)]=i,i}},o=function(r,t,n){if("number"===t.type){var i=a(r,t,n);return i.key=n.path,i.type="number",n.lookup[e.stringify(n.path)]=i,i}},l=function(r,t,n){if("integer"===t.type){var i=a(r,t,n);return i.key=n.path,i.type="number",n.lookup[e.stringify(n.path)]=i,i}},u=function(r,t,n){if("boolean"===t.type){var i=a(r,t,n);return i.key=n.path,i.type="checkbox",n.lookup[e.stringify(n.path)]=i,i}},s=function(t,n,i){if("string"===n.type&&n["enum"]){var o=a(t,n,i);return o.key=i.path,o.type="select",o.titleMap||(o.titleMap=r(n["enum"])),i.lookup[e.stringify(i.path)]=o,o}},c=function(t,n,i){if("array"===n.type&&n.items&&n.items["enum"]){var o=a(t,n,i);return o.key=i.path,o.type="checkboxes",o.titleMap||(o.titleMap=r(n.items["enum"])),i.lookup[e.stringify(i.path)]=o,o}},f=function(r,t,i){if("object"===t.type){var o=a(r,t,i);return o.type="fieldset",o.items=[],i.lookup[e.stringify(i.path)]=o,angular.forEach(t.properties,function(r,a){var l=i.path.slice();if(l.push(a),i.ignore[e.stringify(l)]!==!0){var u=t.required&&-1!==t.required.indexOf(a),s=n(a,r,{path:l,required:u||!1,lookup:i.lookup,ignore:i.ignore});s&&o.items.push(s)}}),o}},m=function(r,t,i){if("array"===t.type){var o=a(r,t,i);o.type="array",o.key=i.path,i.lookup[e.stringify(i.path)]=o;var l=t.required&&-1!==t.required.indexOf(i.path[i.path.length-1]),u=i.path.slice();return u.push(""),o.items=[n(r,t.items,{path:u,required:l||!1,lookup:i.lookup,ignore:i.ignore,global:i.global})],o}},d={string:[s,i],object:[f],number:[o],integer:[l],"boolean":[u],array:[c,m]},p=function(e){return e};this.defaults=d,this.stdFormObj=a,this.defaultFormDefinition=n,this.postProcess=function(e){p=e},this.appendRule=function(e,r){d[e]||(d[e]=[]),d[e].push(r)},this.prependRule=function(e,r){d[e]||(d[e]=[]),d[e].unshift(r)},this.createStandardForm=a,this.$get=function(){var r={};return r.merge=function(n,a,i,o,l){a=a||["*"],o=o||{},l=l||n.readonly||n.readOnly;var u=r.defaults(n,i,o),s=a.indexOf("*");-1!==s&&(a=a.slice(0,s).concat(u.form).concat(a.slice(s+1)));var c=u.lookup;return p(a.map(function(a){if("string"==typeof a&&(a={key:a}),a.key&&"string"==typeof a.key&&(a.key=e.parse(a.key)),a.titleMap&&(a.titleMap=t(a.titleMap)),a.itemForm){a.items=[];var u=e.stringify(a.key),s=c[u];angular.forEach(s.items,function(e){var r=angular.copy(a.itemForm);r.key=e.key,a.items.push(r)})}if(a.key){var f=e.stringify(a.key);c[f]&&(a=angular.extend(c[f],a))}return l===!0&&(a.readonly=!0),a.items&&(a.items=r.merge(n,a.items,i,o,a.readonly)),a.tabs&&angular.forEach(a.tabs,function(e){e.items=r.merge(n,e.items,i,o,a.readonly)}),"checkbox"===a.type&&angular.isUndefined(a.schema["default"])&&(a.schema["default"]=!1),a}))},r.defaults=function(e,r,t){var a=[],i={};if(r=r||{},t=t||{},"object"!==e.type)throw new Error('Not implemented. Only type "object" allowed at root level of schema.');return angular.forEach(e.properties,function(o,l){if(r[l]!==!0){var u=e.required&&-1!==e.required.indexOf(l),s=n(l,o,{path:[l],lookup:i,ignore:r,required:u,global:t});s&&a.push(s)}}),{form:a,lookup:i}},r.traverseSchema=function(e,r,t,n){n=angular.isDefined(n)?n:!0,t=t||[];var a=function(e,r,t){if(r(e,t),angular.forEach(e.properties,function(e,n){var i=t.slice();i.push(n),a(e,r,i)}),!n&&e.items){var i=t.slice();i.push(""),a(e.items,r,i)}};a(e,r,t||[])},r.traverseForm=function(e,t){t(e),angular.forEach(e.items,function(e){r.traverseForm(e,t)}),e.tabs&&angular.forEach(e.tabs,function(e){angular.forEach(e.items,function(e){r.traverseForm(e,t)})})},r}}]),angular.module("schemaForm").factory("sfValidator",[function(){var e={};return e.validate=function(e,r){if(!e)return{valid:!0};var t=e.schema;if(!t)return{valid:!0};""===r&&(r=void 0),"number"===e.type&&null===r&&(r=void 0);var n={type:"object",properties:{}},a=e.key[e.key.length-1];n.properties[a]=t,e.required&&(n.required=[a]);var i={};return angular.isDefined(r)&&(i[a]=r),tv4.validateResult(i,n)},e}]),angular.module("schemaForm").directive("sfArray",["sfSelect","schemaForm","sfValidator","sfPath",function(e,r,t,n){var a=function(e){return function(r){r.key&&(r.key[r.key.indexOf("")]=e)}};return{restrict:"A",scope:!0,require:"?ngModel",link:function(i,o,l,u){var s={},c=i.$watch(l.sfArray,function(o){var l=e(o.key,i.model);if(i.$watch("model"+n.normalize(o.key),function(){l=e(o.key,i.model),i.modelArray=l}),angular.isUndefined(l)&&(l=[],e(o.key,i.model,l)),i.modelArray=l,o.items){var f=o.items[0];o.items.length>1&&(f={type:"section",items:o.items.map(function(e){return e.ngModelOptions=o.ngModelOptions,e.readonly=o.readonly,e})})}if(i.copyWithIndex=function(e){if(!s[e]&&f){var t=angular.copy(f);t.arrayIndex=e,r.traverseForm(t,a(e)),s[e]=t}return s[e]},i.appendToArray=function(){var t=l.length,n=i.copyWithIndex(t);if(r.traverseForm(n,function(r){if(r.key){var t;angular.isDefined(r["default"])&&(t=r["default"]),angular.isDefined(r.schema)&&angular.isDefined(r.schema["default"])&&(t=r.schema["default"]),angular.isDefined(t)&&e(r.key,i.model,t)}}),t===l.length){var a,u=e("schema.items.type",o);"object"===u?a={}:"array"===u&&(a=[]),l.push(a)}return i.validateArray&&i.validateArray(),l},i.deleteFromArray=function(e){return l.splice(e,1),i.validateArray&&i.validateArray(),l},o.titleMap||o.startEmpty===!0||0!==l.length||i.appendToArray(),o.titleMap&&o.titleMap.length>0){i.titleMapValues=[];var m=function(e){i.titleMapValues=[],e=e||[],o.titleMap.forEach(function(r){i.titleMapValues.push(-1!==e.indexOf(r.value))})};m(i.modelArray),i.$watchCollection("modelArray",m),i.$watchCollection("titleMapValues",function(e){if(e){for(var r=i.modelArray;r.length>0;)r.shift();o.titleMap.forEach(function(t,n){e[n]&&r.push(t.value)})}})}if(u){var d;i.validateArray=function(){var e=t.validate(o,i.modelArray.length>0?i.modelArray:void 0);e.valid!==!1||!e.error||""!==e.error.dataPath&&e.error.dataPath!=="/"+o.key[o.key.length-1]?u.$setValidity("schema",!0):(u.$setViewValue(i.modelArray),d=e.error,u.$setValidity("schema",!1))},i.$on("schemaFormValidate",i.validateArray),i.hasSuccess=function(){return u.$valid&&!u.$pristine},i.hasError=function(){return u.$invalid},i.schemaError=function(){return d}}c()})}}}]),angular.module("schemaForm").directive("sfChanged",function(){return{require:"ngModel",restrict:"AC",scope:!1,link:function(e,r,t,n){var a=e.$eval(t.sfChanged);a&&a.onChange&&n.$viewChangeListeners.push(function(){angular.isFunction(a.onChange)?a.onChange(n.$modelValue,a):e.evalExpr(a.onChange,{modelValue:n.$modelValue,form:a})})}}}),angular.module("schemaForm").directive("sfSchema",["$compile","schemaForm","schemaFormDecorators","sfSelect","sfPath",function(e,r,t,n,a){var i=/[A-Z]/g,o=function(e,r){return r=r||"_",e.replace(i,function(e,t){return(t?r:"")+e.toLowerCase()})};return{scope:{schema:"=sfSchema",initialForm:"=sfForm",model:"=sfModel",options:"=sfOptions",designMode:"=sfDesignMode"},controller:["$scope",function(e){this.evalInParentScope=function(r,t){return e.$parent.$eval(r,t)}}],replace:!1,restrict:"A",transclude:!0,require:"?form",link:function(i,l,u,s,c){function f(e,r,t){for(index in e)e[index].key[0]==r[0]?e[index].items.push(t):"fieldset"==e[index].type&&f(e[index].items,r,t)}function m(e,r){for(var t=-1,n=0;n<r.length;n++)r[n].key&&e==r[n].key[0]&&(t=n),"fieldset"==r[n].type&&m(e,r[n].items);t>-1&&r.splice(t,1)}i.formCtrl=s;var d={};c(i,function(e){if(e.addClass("schema-form-ignore"),l.prepend(e),l[0].querySelectorAll){var r=l[0].querySelectorAll("[ng-model]");if(r)for(var t=0;t<r.length;t++){var n=r[t].getAttribute("ng-model");d[n.substring(n.indexOf(".")+1)]=!0}}}),i.$on("sf-remove-element",function(e,r){var t=r.element,n=angular.copy(i.schema),a=angular.copy(i.initialForm);delete n.properties[t.key[0]],m(t.key[0],a),i.schema=n,i.initialForm=a}),i.$on("sf-element-added",function(e,r){var t=angular.copy(i.schema),n=angular.copy(i.initialForm);r.element.key=[r.element.key],r.parentKey?f(n,r.parentKey,r.element):n.push(r.element),"fieldset"!=r.element.type&&(t.properties[r.element.key[0]]=r.schemaItem,i.model[l.key]=""),i.schema=t,i.initialForm=n});var p,h={};i.$watch(function(){var s=i.schema,c=i.initialForm||["*"];if(c&&s&&s.type&&(h.form!==c||h.schema!==s)&&Object.keys(s.properties).length>0){h.schema=s,h.form=c;var f=r.merge(s,c,d,i.options),m=document.createDocumentFragment();p&&p.$destroy(),p=i.$new(),p.schemaForm={form:f,schema:s},l.children(":not(.schema-form-ignore)").remove();for(var g={},v=l[0].querySelectorAll("*[sf-insert-field]"),y=0;y<v.length;y++)g[v[y].getAttribute("sf-insert-field")]=v[y];angular.forEach(f,function(e,r){var n=document.createElement(u.sfDecorator||o(t.defaultDecorator,"-"));if(n.setAttribute("form","schemaForm.form["+r+"]"),e.key){var i=g[a.stringify(e.key)];if(i){for(;i.firstChild;)i.removeChild(i.firstChild);return void i.appendChild(n)}}m.appendChild(n)});var k=document.createElement("sf-element-chooser");k.setAttribute("design-mode","designMode"),m.appendChild(k),l[0].appendChild(m),e(l.children())(p),r.traverseSchema(s,function(e,r){if(angular.isDefined(e["default"])){var t=n(r,i.model);angular.isUndefined(t)&&n(r,i.model,e["default"])}})}i.$emit("sf-render-finished",l)})}}}]),angular.module("schemaForm").directive("schemaValidate",["sfValidator",function(e){return{restrict:"A",scope:!1,priority:1e3,require:"ngModel",link:function(r,t,n,a){r.ngModel=a;var i=null,o=function(){return l||(l=r.$eval(n.schemaValidate)),l},l=o();a.$validators?a.$validators.schema=function(r){var t=e.validate(o(),r);return i=t.error,t.valid}:a.$parsers.push(function(r){if(l=o(),!l)return r;var t=e.validate(l,r);return t.valid?(a.$setValidity("schema",!0),r):(a.$setValidity("schema",!1),void(i=t.error))}),r.$on("schemaFormValidate",function(){a.$validate?(a.$validate(),a.$invalid&&(a.$dirty=!0,a.$pristine=!1)):a.$setViewValue(a.$viewValue)}),r.hasSuccess=function(){return a.$valid&&(!a.$pristine||!a.$isEmpty(a.$modelValue))},r.hasError=function(){return a.$invalid&&!a.$pristine},r.schemaError=function(){return i}}}}]),function(){function e(){return{restrict:"E",templateUrl:"directives/sf-element-chooser.html",scope:{designMode:"=",parentKey:"="},controller:function(e){e.menuItems=[{type:"text",label:"Text Element"},{type:"datepicker",label:"Date Element"},{type:"fieldset",label:"Section Element"}],e.addElement=function(r){e.$emit("sf-adding-element",{type:r,parentKey:e.parentKey})}}}}angular.module("schemaForm").directive("sfElementChooser",e)}();